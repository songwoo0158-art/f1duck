<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My F1 Hub (v7 - Filters & Size)</title>
    <style>
        /* --- V7 ìŠ¤íƒ€ì¼ ë³€ê²½/ì¶”ê°€ --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
        }
        h2 {
            color: #18181b;
        }

        /* V7: í•„í„° ê·¸ë£¹í•‘ ìŠ¤íƒ€ì¼ */
        .filter-group {
            margin-bottom: 15px;
        }
        .filter-group label {
            font-weight: 600;
            margin-right: 10px;
            font-size: 0.95rem;
            color: #333;
        }
        .filter-group div { /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
            display: inline-block;
        }

        .filter-btn {
            padding: 8px 15px;
            margin-right: 10px;
            border: none;
            border-radius: 6px;
            background-color: #ffffff;
            color: #333;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: background-color 0.2s;
        }
        .filter-btn:hover {
            background-color: #e9e9ed;
        }
        .filter-btn.active {
            background-color: #0d6efd;
            color: white;
        }

        /* V7: ì•„ì´í…œ í¬ê¸° 2ë°° (minmax 200px -> 350px) */
        #shorts-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px; /* ê°­ë„ ì¡°ê¸ˆ ëŠ˜ë¦¼ */
        }
        
        .video-item {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        .video-item:hover {
            transform: translateY(-5px);
        }
        .video-item img {
            width: 100%;
            height: auto;
            display: block;
        }
        .video-item p {
            padding: 10px 12px; /* íŒ¨ë”© ì¡°ê¸ˆ ì¡°ì ˆ */
            font-size: 1rem; /* í°íŠ¸ ì¡°ê¸ˆ í‚¤ì›€ */
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* V7: ì•„ì´í”„ë ˆì„ ë†’ì´ ì¡°ì ˆ (ë” ì»¤ì§„ ë„ˆë¹„ì— ë§ê²Œ) */
        .video-item iframe {
            width: 100%;
            height: 500px; /* 400px -> 500px */
            border: none;
            display: block;
        }

        #pagination-container {
            text-align: center;
            margin-top: 25px;
        }
        #next-page-btn {
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            background-color: #0d6efd;
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            display: none;
        }
        #next-page-btn:hover {
            background-color: #0b5ed7;
        }
    </style>

    <script>
        // 1. ì—¬ê¸°ì— ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. (íŒŒì¼ ìƒë‹¨)
        const API_KEY = 'AIzaSyDs3rdUWpFuNlsST16Do4Fb3pCn3gBf0PA';

        document.addEventListener('DOMContentLoaded', function() {
            // --- V7: JS ë¡œì§ ê°œí¸ ---
            
            // HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const shortsContainer = document.getElementById('shorts-container');
            const nextPageButton = document.getElementById('next-page-btn');
            const periodFilters = document.querySelectorAll('.period-btn');
            const orderFilters = document.querySelectorAll('.order-btn');
            const langFilters = document.querySelectorAll('.lang-btn');

            // API í˜¸ì¶œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë³€ìˆ˜ë“¤
            let currentPeriod = 'week';
            let currentOrder = 'viewCount';
            let currentLang = 'global';
            let currentNextPageToken = null; 
            let currentBaseUrl = ''; 

            // (V6ì™€ ë™ì¼) ë‚ ì§œ ë³€í™˜ í•¨ìˆ˜
            function getPublishedAfterDate(period) {
                const date = new Date();
                switch (period) {
                    case 'today': date.setDate(date.getDate() - 1); break;
                    case 'week': date.setDate(date.getDate() - 7); break;
                    case 'month': date.setDate(date.getDate() - 30); break;
                    case 'all': default: return null;
                }
                return date.toISOString(); 
            }

            /**
             * (V7) API URL ìƒì„± í•¨ìˆ˜ - 3ê°œ í•„í„° ìƒíƒœë¥¼ ëª¨ë‘ ë°˜ì˜
             */
            function createBaseApiUrl() {
                const publishedAfter = getPublishedAfterDate(currentPeriod);
                
                // ê¸°ë³¸ URL (ì •ë ¬ ê¸°ì¤€(order) ë³€ìˆ˜í™”)
                let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=F1&order=${currentOrder}&type=video&videoDuration=short&videoEmbeddable=true&maxResults=12&key=${API_KEY}`;
                
                // ê¸°ê°„ í•„í„° ì¶”ê°€
                if (publishedAfter) {
                    url += `&publishedAfter=${publishedAfter}`;
                }

                // (V7) ì–¸ì–´ í•„í„° ì¶”ê°€
                if (currentLang === 'korean') {
                    url += `&relevanceLanguage=ko&regionCode=KR`;
                }
                // 'global'ì€ ì•„ë¬´ê²ƒë„ ì¶”ê°€ ì•ˆ í•¨

                return url;
            }

            // (V6ì™€ ë™ì¼) 2ë‹¨ê³„ ê²€ì¦ ë° í‘œì‹œ í•¨ìˆ˜
            function fetchAndDisplayVideos(apiUrl, isPagination = false) {
                if (!isPagination) {
                    shortsContainer.innerHTML = '';
                    currentNextPageToken = null; 
                    nextPageButton.style.display = 'none'; 
                }
                
                let searchItems = []; 
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        currentNextPageToken = data.nextPageToken || null;
                        searchItems = data.items || [];
                        if (searchItems.length === 0) {
                            if (!isPagination) {
                                shortsContainer.innerHTML = "<p>í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                            }
                            return null;
                        }
                        const videoIds = searchItems.map(item => item.id.videoId).join(',');
                        const verificationUrl = `https://www.googleapis.com/youtube/v3/videos?part=status&id=${videoIds}&key=${API_KEY}`;
                        return fetch(verificationUrl); 
                    })
                    .then(response => {
                        if (response === null) return null;
                        return response.json();
                    })
                    .then(videoData => {
                        if (videoData === null) return; 

                        const embeddableIds = new Set(
                            videoData.items
                                .filter(item => item.status.embeddable)
                                .map(item => item.id)
                        );

                        const displayItems = searchItems.filter(item => 
                            embeddableIds.has(item.id.videoId)
                        );

                        if (currentNextPageToken) {
                            nextPageButton.style.display = 'block';
                        } else {
                            nextPageButton.style.display = 'none';
                        }
                        if (displayItems.length === 0) {
                            if (!isPagination) {
                                shortsContainer.innerHTML = "<p>í•´ë‹¹ ì¡°ê±´ì— (ì¬ìƒ ê°€ëŠ¥í•œ) ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                            }
                            return;
                        }
                        displayItems.forEach(item => {
                            const videoId = item.id.videoId;
                            const title = item.snippet.title;
                            const thumbnail = item.snippet.thumbnails.medium.url;
                            const videoElement = `
                                <div class="video-item" data-videoid="${videoId}">
                                    <img src="${thumbnail}" alt="${title}">
                                    <p>${title}</p>
                                </div>
                            `;
                            shortsContainer.innerHTML += videoElement;
                        });
                    })
                    .catch(error => {
                        console.error('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                        shortsContainer.innerHTML = "<p>ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>";
                    });
            }

            /**
             * (V7) ìƒˆ ê²€ìƒ‰ì„ ì‹œì‘í•˜ëŠ” í†µí•© í•¨ìˆ˜
             */
            function loadNewSearch() {
                currentBaseUrl = createBaseApiUrl(); // ìƒˆ URL ìƒì„±
                fetchAndDisplayVideos(currentBaseUrl, false); // 'false' = í˜ì´ì§€ë„¤ì´ì…˜ ì•„ë‹˜ (ëª©ë¡ ì´ˆê¸°í™”)
            }

            // --- V7: í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ê°œí¸) ---

            // 1. ê¸°ê°„ í•„í„°
            periodFilters.forEach(button => {
                button.addEventListener('click', function() {
                    periodFilters.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period; // ê¸°ê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
                    loadNewSearch(); // ìƒˆ ê²€ìƒ‰ ì‹¤í–‰
                });
            });

            // 2. ì •ë ¬ í•„í„°
            orderFilters.forEach(button => {
                button.addEventListener('click', function() {
                    orderFilters.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentOrder = this.dataset.order; // ì •ë ¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    loadNewSearch(); // ìƒˆ ê²€ìƒ‰ ì‹¤í–‰
                });
            });

            // 3. ì–¸ì–´ í•„í„°
            langFilters.forEach(button => {
                button.addEventListener('click', function() {
                    langFilters.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentLang = this.dataset.lang; // ì–¸ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸
                    loadNewSearch(); // ìƒˆ ê²€ìƒ‰ ì‹¤í–‰
                });
            });

            // (V6ì™€ ë™ì¼) 'ë‹¤ìŒ' ë²„íŠ¼ ì´ë²¤íŠ¸
            nextPageButton.addEventListener('click', function() {
                if (currentNextPageToken && currentBaseUrl) {
                    const nextPageUrl = `${currentBaseUrl}&pageToken=${currentNextPageToken}`;
                    fetchAndDisplayVideos(nextPageUrl, true);
                }
            });

            // (V6ì™€ ë™ì¼) ë¹„ë””ì˜¤ í´ë¦­ ì´ë²¤íŠ¸
            shortsContainer.addEventListener('click', function(event) {
                const videoItem = event.target.closest('.video-item');
                if (videoItem && !videoItem.querySelector('iframe')) {
                    const videoId = videoItem.dataset.videoid;
                    videoItem.innerHTML = `
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}?autoplay=1" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    `;
                    videoItem.style.transform = 'none';
                    videoItem.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.2)';
                }
            });

            // --- (V7) í˜ì´ì§€ ì²« ë¡œë“œ ì‹œ ---
            // ê¸°ë³¸ê°’: ì¼ì£¼ì¼ / ì¡°íšŒìˆ˜ ìˆœ / ì „ì²´
            // ê¸°ë³¸ í™œì„±í™”ëœ ë²„íŠ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì²« ê²€ìƒ‰ ì‹¤í–‰
            loadNewSearch();
        });
    </script>
</head>
<body>

    <h2>ğŸï¸ F1 ìˆí¼</h2>

    <div class="filter-group">
        <label>ê¸°ê°„:</label>
        <div id="period-filter-container">
            <button class="filter-btn period-btn" data-period="today">ì˜¤ëŠ˜</button>
            <button class="filter-btn period-btn active" data-period="week">ì¼ì£¼ì¼</button>
            <button class="filter-btn period-btn" data-period="month">í•œë‹¬</button>
            <button class="filter-btn period-btn" data-period="all">ì˜¬íƒ€ì„</button>
        </div>
    </div>

    <div class="filter-group">
        <label>ì •ë ¬:</label>
        <div id="order-filter-container">
            <button class="filter-btn order-btn active" data-order="viewCount">ì¡°íšŒìˆ˜ ìˆœ</button>
            <button class="filter-btn order-btn" data-order="relevance">ê´€ë ¨ì„± ìˆœ</button>
        </div>
    </div>

    <div class="filter-group">
        <label>ì–¸ì–´:</label>
        <div id="lang-filter-container">
            <button class="filter-btn lang-btn active" data-lang="global">ì „ì²´</button>
            <button class="filter-btn lang-btn" data-lang="korean">í•œêµ­ì–´</button>
        </div>
    </div>
    
    <hr style="border:0; border-top: 1px solid #ddd; margin: 25px 0;">

    <div id="shorts-container"></div>

    <div id="pagination-container">
        <button id="next-page-btn">ë‹¤ìŒ 12ê°œ ë³´ê¸°</button>
    </div>

</body>
</html>
